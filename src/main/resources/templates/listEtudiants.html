<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste des √©tudiants</title>
    <style>
        :root{
            --bg:#f6f9fc;
            --card:#ffffff;
            --primary:#4f46e5;
            --primary-dark:#4338ca;
            --muted:#6b7280;
            --success:#10b981;
            --warning:#f59e0b;
            --danger:#ef4444;
            --border:#e6e9ef;
            --shadow:0 6px 18px rgba(15,23,42,0.06);
        }

        html,body{
            height:100%;
            margin:0;
            font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
            background:var(--bg);
            color:#111827;
            line-height:1.6;
        }

        .wrap{
            max-width:1200px;
            margin:36px auto;
            padding:20px;
        }

        .card{
            background:var(--card);
            border-radius:12px;
            box-shadow:var(--shadow);
            padding:0;
            border:1px solid var(--border);
            overflow:hidden;
        }

        header{
            display:flex;
            align-items:center;
            justify-content:space-between;
            margin-bottom:18px;
            padding:0 30px;
            padding-top:30px;
        }

        h1{
            font-size:1.5rem;
            margin:0;
            color:#0f172a;
            font-weight:700;
        }

        .sub{
            color:var(--muted);
            font-size:0.9rem;
            margin-top:4px;
        }

        .actions{
            display:flex;
            gap:12px;
            align-items:center;
        }

        .btn{
            display:inline-flex;
            align-items:center;
            gap:6px;
            padding:10px 18px;
            border-radius:8px;
            text-decoration:none;
            font-weight:600;
            font-size:0.9rem;
            cursor:pointer;
            border:1px solid transparent;
            transition:all 0.2s ease;
        }

        .btn-primary{
            background:var(--primary);
            color:white;
            box-shadow:0 2px 4px rgba(79, 70, 229, 0.2);
        }

        .btn-primary:hover{
            background:var(--primary-dark);
            transform:translateY(-1px);
            box-shadow:0 4px 8px rgba(79, 70, 229, 0.3);
        }

        .btn-outline{
            background:transparent;
            color:var(--primary);
            border-color:var(--primary);
        }

        .btn-outline:hover{
            background:var(--primary);
            color:white;
        }

        .table-wrap{
            overflow:auto;
            border-radius:8px;
            margin:0 30px 30px 30px;
            border:1px solid var(--border);
        }

        table{
            width:100%;
            border-collapse:collapse;
            background:transparent;
            min-width:680px;
        }

        thead tr{
            background:#fbfbff;
            border-bottom:2px solid var(--border);
        }

        th,td{
            padding:14px 16px;
            text-align:left;
            border-bottom:1px solid var(--border);
            font-size:0.95rem;
        }

        th{
            font-weight:700;
            color:#0b1220;
            font-size:0.9rem;
            text-transform:uppercase;
            letter-spacing:0.5px;
        }

        tbody tr{
            transition:background-color 0.2s ease;
        }

        tbody tr:hover{
            background:#fcfdff;
            box-shadow:0 2px 8px rgba(0,0,0,0.05);
        }

        .actions-cell{
            display:flex;
            gap:12px;
        }

        .actions-cell a{
            padding:6px 12px;
            border-radius:6px;
            text-decoration:none;
            font-weight:600;
            font-size:0.85rem;
            transition:all 0.2s ease;
            border:1px solid transparent;
        }

        .actions-cell a:first-child{
            color:var(--primary);
            background:rgba(79, 70, 229, 0.1);
            border-color:rgba(79, 70, 229, 0.2);
        }

        .actions-cell a:first-child:hover{
            background:var(--primary);
            color:white;
        }

        .actions-cell a:nth-child(2){
            color:var(--warning);
            background:rgba(245, 158, 11, 0.1);
            border-color:rgba(245, 158, 11, 0.2);
        }

        .actions-cell a:nth-child(2):hover{
            background:var(--warning);
            color:white;
        }

        .actions-cell a.delete{
            color:var(--danger);
            background:rgba(239, 68, 68, 0.1);
            border-color:rgba(239, 68, 68, 0.2);
        }

        .actions-cell a.delete:hover{
            background:var(--danger);
            color:white;
        }

        .no-data{
            padding:40px 20px;
            text-align:center;
            color:var(--muted);
            font-style:italic;
        }

        /* Styles pour la navbar */
        .navbar-top {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 30px;
            margin-bottom: 20px;
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info strong {
            color: white;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        /* Styles pour les badges de r√¥le */
        .role-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .role-admin {
            background: rgba(220, 38, 38, 0.8);
        }

        .role-user {
            background: rgba(16, 185, 129, 0.8);
        }

        /* Messages de statut */
        .admin-status {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border: 1px solid #fecaca;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 15px 30px 0 30px;
            color: #7f1d1d;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-status {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #fcd34d;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 15px 30px 0 30px;
            color: #78350f;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Animation subtile */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 768px){
            .wrap{
                padding:15px;
                margin:20px auto;
            }

            header{
                flex-direction:column;
                gap:15px;
                align-items:flex-start;
                padding:20px;
            }

            .actions{
                width:100%;
                justify-content:flex-end;
            }

            .navbar-content{
                flex-direction:column;
                gap:15px;
                align-items:flex-start;
            }

            .nav-buttons{
                width:100%;
                justify-content:flex-end;
            }

            .table-wrap{
                margin:0 15px 20px 15px;
            }

            th,td{
                padding:10px 12px;
            }

            .admin-status,
            .user-status{
                margin:15px 20px 0 20px;
            }
        }

        @media (max-width: 600px){
            .actions-cell{
                flex-direction:column;
                gap:8px;
            }

            .actions-cell a{
                text-align:center;
                justify-content:center;
            }
        }
    </style>
</head>
<body>
<div class="wrap">
    <div class="card">
        <!-- Navbar am√©lior√©e -->
        <div class="navbar-top">
            <div class="navbar-content">
                <div class="user-info">
                    üë§ Connect√© en tant que: <strong sec:authentication="name">Utilisateur</strong>
                    <span class="role-badge role-admin" sec:authorize="hasRole('ADMIN')">ADMIN</span>
                    <span class="role-badge role-user" sec:authorize="hasRole('USER')">USER</span>
                </div>
                <div class="nav-buttons">
                    <a th:href="@{/}" class="btn btn-outline" style="color: white; border-color: rgba(255,255,255,0.5);">üè† Accueil</a>
                    <a th:href="@{/logout}" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">üö™ D√©connexion</a>
                </div>
            </div>
        </div>

        <!-- Messages de statut am√©lior√©s -->
        <div sec:authorize="hasRole('ADMIN')" class="admin-status">
            ‚ö° Mode Administrateur - Acc√®s complet (CRUD)
        </div>

        <div sec:authorize="hasRole('USER')" class="user-status">
            üë§ Mode Lecture Seulement - Consultation des donn√©es uniquement
        </div>

        <header>
            <div>
                <h1>üéì Liste des √©tudiants</h1>
                <div class="sub">Gestion compl√®te du registre des √©tudiants - Interface administrateur</div>
            </div>
            <div class="actions">
                <!-- Bouton "Ajouter" seulement pour ADMIN -->
                <a th:href="@{/etudiants/ajout}"
                   class="btn btn-primary"
                   sec:authorize="hasRole('ADMIN')">
                    ‚ûï Nouvel √©tudiant
                </a>
            </div>
        </header>

        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th style="width:80px">ID</th>
                    <th>Nom</th>
                    <th>Pr√©nom</th>
                    <th>Email</th>
                    <th style="width:80px">√Çge</th>
                    <th style="width:240px">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="etudiant : ${etudiants}">
                    <td th:text="${etudiant.id}" style="font-weight: 600; color: var(--primary);">1</td>
                    <td th:text="${etudiant.nom}">Nom</td>
                    <td th:text="${etudiant.prenom}">Pr√©nom</td>
                    <td th:text="${etudiant.email}" style="color: var(--primary);">email@example.com</td>
                    <td th:text="${etudiant.age}" style="text-align: center;">20</td>
                    <td class="actions-cell">
                        <!-- Voir - accessible √† tous -->
                        <a th:href="@{/etudiants/details/{id}(id=${etudiant.id})}">
                            üëÅÔ∏è Voir
                        </a>

                        <!-- Modifier - seulement ADMIN -->
                        <a th:href="@{/etudiants/modifier/{id}(id=${etudiant.id})}"
                           sec:authorize="hasRole('ADMIN')">
                            ‚úèÔ∏è Modifier
                        </a>

                        <!-- Supprimer - seulement ADMIN -->
                        <a th:href="@{/etudiants/delete/{id}(id=${etudiant.id})}"
                           sec:authorize="hasRole('ADMIN')"
                           onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cet √©tudiant ? Cette action est irr√©versible.')"
                           class="delete">
                            üóëÔ∏è Supprimer
                        </a>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(etudiants)}">
                    <td class="no-data" colspan="6">
                        üìù Aucun √©tudiant trouv√© dans la base de donn√©es
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Animation subtile pour les lignes du tableau
    document.addEventListener('DOMContentLoaded', function() {
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach((row, index) => {
            row.style.animationDelay = `${index * 0.05}s`;
        });
    });
</script>
</body>
</html>